<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MapFish Print</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; }
        button { background: #007bff; color: white; border: none; padding: 10px 20px; border-radius: 4px; cursor: pointer; margin: 5px; }
        button:hover { background: #0056b3; }
        .url-box { background: #f8f9fa; padding: 10px; border-radius: 4px; font-family: monospace; word-break: break-all; margin: 10px 0; }
        .status { margin: 10px 0; padding: 10px; border-radius: 4px; }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
        .info { background: #d1ecf1; color: #0c5460; }
    </style>
</head>
<body>
    <h1>üó∫Ô∏è MapFish Print</h1>

    <h3>Choose Layout:</h3>
    <button onclick="createPrintJob('A4 portrait')">üìÑ A4 Portrait</button>
    <button onclick="createPrintJob('A4 landscape')">üìÑ A4 Landscape</button>
    <button onclick="createPrintJob('A4 simple')">üìÑ A4 Simple</button>
    <button onclick="createGAWMTSPrintJob()">üåç GA WMTS</button>

    <div id="status"></div>
    <div id="urls"></div>

    <script>
        const BASE_URL = 'http://localhost:18083';
        const APP_NAME = 'default';

        function getRequestData(layout) {
            const baseData = {
                "attributes": {
                    "map": {
                        "bbox": [87741.27046802844, 5468479.575967243, 1090000.7295319715, 5892512.424032757],
                        "dpi": 200,
                        "layers": [{
                            "baseURL": "https://ows.terrestris.de/osm/service?",
                            "customParams": {"LAYERS": "OSM-WMS", "STYLES": "", "TRANSPARENT": true, "VERSION": "1.1.1"},
                            "tileSize": [512, 512],
                            "layers": ["OSM-WMS"],
                            "opacity": 1,
                            "styles": [""],
                            "type": "tiledwms"
                        }],
                        "projection": "EPSG:25832",
                        "rotation": 0
                    }
                },
                "layout": layout
            };

            // Add legend only for portrait and landscape (not simple)
            if (layout !== 'A4 simple') {
                baseData.attributes.legend = {
                    "name": "",
                    "classes": [{
                        "name": "OSM-WMS",
                        "icons": ["https://ows.terrestris.de/osm/service?SERVICE=WMS&REQUEST=GetLegendGraphic&VERSION=1.3.0&LAYER=OSM-WMS&FORMAT=image/png"]
                    }]
                };
            }

            return baseData;
        }

        function showStatus(message, type = 'info') {
            document.getElementById('status').innerHTML = `<div class="status ${type}">${message}</div>`;
        }

        async function createPrintJob(layout) {
            showStatus(`üöÄ Creating ${layout} print job...`, 'info');

            try {
                const requestData = getRequestData(layout);
                const response = await fetch(`${BASE_URL}/print/${APP_NAME}/report.pdf`, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify(requestData)
                });

                const result = await response.json();
                const jobRef = result.ref;

                if (jobRef) {
                    const downloadUrl = `${BASE_URL}/print/${APP_NAME}/report/${jobRef}`;

                    showStatus(`‚úÖ ${layout} print job created!`, 'success');
                    document.getElementById('urls').innerHTML = `
                        <p><strong>Layout:</strong> ${layout}</p>
                        <p><strong>Download URL:</strong></p>
                        <div class="url-box">${downloadUrl}</div>
                        <button onclick="window.open('${downloadUrl}', '_blank')">üì• Download PDF</button>
                    `;
                } else {
                    showStatus('‚ùå No job reference received', 'error');
                }
            } catch (error) {
                showStatus(`‚ùå Error: ${error.message}`, 'error');
            }
        }

        async function createGAWMTSPrintJob() {
            showStatus(`üöÄ Creating GA WMTS print job...`, 'info');

            try {
                const requestData = {
                    "attributes": {
                        "map": {
                            "bbox": [87741, 5468479, 1090000, 7598600],
                            "dpi": 200,
                            "layers": [{
                                "baseURL": "https://sgx.geodatenzentrum.de/wmts_basemapde/tile/1.0.0/{Layer}/{style}/{TileMatrixSet}/{TileMatrix}/{TileRow}/{TileCol}.png",
                                         
                                "customParams": {"LAYERS": "de_basemapde_web_raster_farbe", "STYLES": "default", "TRANSPARENT": true, "VERSION": "1.0.0"},
                                "layer": "de_basemapde_web_raster_farbe",
                                "matrixSet": "DE_EPSG_3857_ADV",
                                "imageFormat": "image/png",
                                "style": "default",
                                "type": "wmts",
                                "matrices": [
                                    {"identifier": "00", "scaleDenominator": 17471320.750897426, "topLeftCorner": [-20037508.3427892, 20037508.3427892], "tileSize": [256, 256], "matrixSize": [32, 32]},
                                    {"identifier": "01", "scaleDenominator": 8735660.375448713, "topLeftCorner": [-20037508.3427892, 20037508.3427892], "tileSize": [256, 256], "matrixSize": [64, 64]},
                                    {"identifier": "02", "scaleDenominator": 4367830.187724357, "topLeftCorner": [-20037508.3427892, 20037508.3427892], "tileSize": [256, 256], "matrixSize": [128, 128]},
                                    {"identifier": "03", "scaleDenominator": 2183915.0938621783, "topLeftCorner": [-20037508.3427892, 20037508.3427892], "tileSize": [256, 256], "matrixSize": [256, 256]},
                                    {"identifier": "04", "scaleDenominator": 1091957.5469310891, "topLeftCorner": [-20037508.3427892, 20037508.3427892], "tileSize": [256, 256], "matrixSize": [512, 512]},
                                    {"identifier": "05", "scaleDenominator": 545978.7734655463, "topLeftCorner": [-20037508.3427892, 20037508.3427892], "tileSize": [256, 256], "matrixSize": [1024, 1024]},
                                    {"identifier": "06", "scaleDenominator": 272989.38673277246, "topLeftCorner": [-20037508.3427892, 20037508.3427892], "tileSize": [256, 256], "matrixSize": [2048, 2048]},
                                    {"identifier": "07", "scaleDenominator": 136494.69336638605, "topLeftCorner": [-20037508.3427892, 20037508.3427892], "tileSize": [256, 256], "matrixSize": [4096, 4096]},
                                    {"identifier": "08", "scaleDenominator": 68247.3466831932, "topLeftCorner": [-20037508.3427892, 20037508.3427892], "tileSize": [256, 256], "matrixSize": [8192, 8192]},
                                    {"identifier": "09", "scaleDenominator": 34123.673341596535, "topLeftCorner": [-20037508.3427892, 20037508.3427892], "tileSize": [256, 256], "matrixSize": [16384, 16384]},
                                    {"identifier": "10", "scaleDenominator": 17061.836670798286, "topLeftCorner": [-20037508.3427892, 20037508.3427892], "tileSize": [256, 256], "matrixSize": [32768, 32768]},
                                    {"identifier": "11", "scaleDenominator": 8530.918335399143, "topLeftCorner": [-20037508.3427892, 20037508.3427892], "tileSize": [256, 256], "matrixSize": [65536, 65536]},
                                    {"identifier": "12", "scaleDenominator": 4265.4591676995715, "topLeftCorner": [-20037508.3427892, 20037508.3427892], "tileSize": [256, 256], "matrixSize": [131072, 131072]},
                                    {"identifier": "13", "scaleDenominator": 2132.729583849782, "topLeftCorner": [-20037508.3427892, 20037508.3427892], "tileSize": [256, 256], "matrixSize": [262144, 262144]}
                                ]
                            }],
                            "projection": "EPSG:3857",
                            "rotation": 0
                        }
                    },
                    "layout": "A4 simple"
                };

                const response = await fetch(`${BASE_URL}/print/${APP_NAME}/report.pdf`, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify(requestData)
                });

                const result = await response.json();
                const jobRef = result.ref;

                if (jobRef) {
                    const downloadUrl = `${BASE_URL}/print/${APP_NAME}/report/${jobRef}`;

                    showStatus(`‚úÖ GA WMTS print job created!`, 'success');
                    document.getElementById('urls').innerHTML = `
                        <p><strong>Layout:</strong> A4 Simple (GA WMTS)</p>
                        <p><strong>Layer:</strong> de_basemapde_web_raster_farbe</p>
                        <p><strong>Matrix Set:</strong> DE_EPSG_3857_ADV</p>
                        <p><strong>Download URL:</strong></p>
                        <div class="url-box">${downloadUrl}</div>
                        <button onclick="window.open('${downloadUrl}', '_blank')">üì• Download PDF</button>
                    `;
                } else {
                    showStatus('‚ùå No job reference received', 'error');
                }
            } catch (error) {
                showStatus(`‚ùå Error: ${error.message}`, 'error');
            }
        }
    </script>
</body>
</html>
